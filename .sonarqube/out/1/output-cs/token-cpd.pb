–&
4D:\Fontys\S3\API\API\Controllers\FollowController.cs
	namespace 	
API
 
. 
Controllers 
{ 
[ 
	Authorize 
] 
[ 
Route 

(
 
$str 
) 
] 
[ 
ApiController 
] 
public 

class 
FollowController !
:" #
ControllerBase$ 2
{ 
private 
readonly 
IFollowDatabase (
	_database) 2
;2 3
private 
readonly 
UserService $
userService% 0
;0 1
public 
FollowController 
(  
IFollowDatabase  /
database0 8
,8 9
UserService: E
userServiceF Q
)Q R
{ 	
this 
. 
userService 
= 
userService *
;* +
	_database 
= 
database  
;  !
} 	
[ 	
HttpGet	 
] 
public 
async 
Task 
< 
List 
< 
CreatorFans *
>* +
>+ ,
GetFollowers- 9
(9 :
): ;
{ 	
var   
name   
=   
User   
.   
Claims   "
.  " #
Where  # (
(  ( )
i  ) *
=>  + -
i  . /
.  / 0
Type  0 4
==  5 7
$str  8 >
)  > ?
.  ? @
FirstOrDefault  @ N
(  N O
)  O P
.  P Q
Value  Q V
;  V W
Creator!! 
creator!! 
=!! 
await!! #
userService!!$ /
.!!/ 0 
GetCreatorByUserName!!0 D
(!!D E
name!!E I
)!!I J
;!!J K
return## 
await## 
	_database## "
.##" #
GetFollowers### /
(##/ 0
creator##0 7
.##7 8
Id##8 :
)##: ;
;##; <
}%% 	
['' 	
HttpGet''	 
('' 
$str'' 
)'' 
]'' 
public(( 
async(( 
Task(( 
<(( 
List(( 
<(( 
CreatorFans(( *
>((* +
>((+ ,
GetFollowings((- :
(((: ;
)((; <
{)) 	
var** 
name** 
=** 
User** 
.** 
Claims** "
.**" #
Where**# (
(**( )
i**) *
=>**+ -
i**. /
.**/ 0
Type**0 4
==**5 7
$str**8 >
)**> ?
.**? @
FirstOrDefault**@ N
(**N O
)**O P
.**P Q
Value**Q V
;**V W
Fan++ 
fan++ 
=++ 
await++ 
userService++ '
.++' (
GetFanByUsername++( 8
(++8 9
name++9 =
)++= >
;++> ?
return-- 
await-- 
	_database-- "
.--" #
GetFollowings--# 0
(--0 1
fan--1 4
.--4 5
Id--5 7
)--7 8
;--8 9
}// 	
[11 	
HttpPost11	 
]11 
public22 
async22 
Task22 
<22 
ActionResult22 &
<22& '
bool22' +
>22+ ,
>22, -

PostFollow22. 8
(228 9
CreatorFans229 D
followModel22E P
)22P Q
{33 	
var44 
name44 
=44 
User44 
.44 
Claims44 "
.44" #
Where44# (
(44( )
i44) *
=>44+ -
i44. /
.44/ 0
Type440 4
==445 7
$str448 >
)44> ?
.44? @
FirstOrDefault44@ N
(44N O
)44O P
.44P Q
Value44Q V
;44V W
Fan55 
fan55 
=55 
await55 
userService55 '
.55' (
GetFanByUsername55( 8
(558 9
name559 =
)55= >
;55> ?
followModel66 
.66 
FanId66 
=66 
fan66  #
.66# $
Id66$ &
;66& '
var77 
response77 
=77 
await77  
	_database77! *
.77* +
PostFollower77+ 7
(777 8
followModel778 C
)77C D
;77D E
if88 
(88 
!88 
response88 
)88 
return99 

BadRequest99 !
(99! "
)99" #
;99# $
return:: 
Ok:: 
(:: 
):: 
;:: 
};; 	
}<< 
}== Ö
3D:\Fontys\S3\API\API\Controllers\LoginController.cs
	namespace 	
API
 
. 
Controllers 
{ 
[ 
Route 

(
 
$str 
) 
] 
[ 
ApiController 
] 
public 

class 
LoginController  
:! "
ControllerBase# 1
{ 
private 
readonly 
ILoginDatabase '
	_database( 1
;1 2
private 
readonly !
AuthenticationService .!
authenticationService/ D
;D E
public 
LoginController 
( 
ILoginDatabase -
database. 6
,6 7!
AuthenticationService8 M!
authenticationServiceN c
)c d
{ 	
	_database 
= 
database  
;  !
this 
. !
authenticationService &
=' (!
authenticationService) >
;> ?
} 	
[ 	
HttpGet	 
( 
$str 
) 
] 
public 
async 
Task 
< 
ActionResult &
<& '
bool' +
>+ ,
>, -
LoginFan. 6
(6 7
string7 =
username> F
,F G
stringH N
passwordO W
)W X
{ 	
var 
result 
= 
await 
	_database (
.( )
LoginFan) 1
(1 2
username2 :
,: ;
password< D
)D E
;E F
return 
result 
; 
}   	
["" 	
HttpGet""	 
("" 
$str"" 
)"" 
]"" 
public## 
async## 
Task## 
<## 
ActionResult## &
<##& '
bool##' +
>##+ ,
>##, -
LoginCreator##. :
(##: ;
string##; A
username##B J
,##J K
string##L R
password##S [
)##[ \
{$$ 	
var%% 
result%% 
=%% 
await%% 
	_database%% (
.%%( )
LoginCreator%%) 5
(%%5 6
username%%6 >
,%%> ?
password%%@ H
)%%H I
;%%I J
return&& 
result&& 
;&& 
}'' 	
[)) 	
AllowAnonymous))	 
])) 
[** 	
HttpPost**	 
(** 
$str**  
)**  !
]**! "
public++ 
async++ 
Task++ 
<++ 
string++  
>++  !
Authenticate++" .
(++. /
[++/ 0
FromBody++0 8
]++8 9

LoginModel++: D

loginModel++E O
)++O P
{,, 	
var-- 
result-- 
=-- 
await-- !
authenticationService-- 4
.--4 5
Authenticate--5 A
(--A B

loginModel--B L
)--L M
;--M N
return.. 
result.. 
;.. 
}// 	
}00 
}11 ı,
2D:\Fontys\S3\API\API\Controllers\PostController.cs
	namespace 	
API
 
. 
Controllers 
{ 
[ 
	Authorize 
] 
[ 
Route 

(
 
$str 
) 
] 
[ 
ApiController 
] 
public 

class 
PostController 
:  !
ControllerBase" 0
{ 
private 
readonly 
IPostDatabase &
	_database' 0
;0 1
private 
readonly 
UserService $
userService% 0
;0 1
public 
PostController 
( 
IPostDatabase +
database, 4
,4 5
UserService6 A
userServiceB M
)M N
{ 	
this 
. 
userService 
= 
userService *
;* +
	_database 
= 
database  
;  !
} 	
[ 	
HttpGet	 
] 
public 
async 
Task 
< 
List 
< 
Post #
># $
>$ %
GetPosts& .
(. /
)/ 0
{ 	
var 
list 
= 
await 
	_database &
.& '
GetPosts' /
(/ 0
)0 1
;1 2
return   
list   
;   
}!! 	
[## 	
HttpPost##	 
]## 
public$$ 
async$$ 
Task$$ 
<$$ 
ActionResult$$ &
<$$& '
bool$$' +
>$$+ ,
>$$, -
PostPost$$. 6
($$6 7
[$$7 8
FromBody$$8 @
]$$@ A
Post$$B F
post$$G K
)$$K L
{%% 	
var'' 
name'' 
='' 
User'' 
.'' 
Claims'' "
.''" #
Where''# (
(''( )
i'') *
=>''+ -
i''. /
.''/ 0
Type''0 4
==''5 7
$str''8 >
)''> ?
.''? @
FirstOrDefault''@ N
(''N O
)''O P
.''P Q
Value''Q V
;''V W
var(( 
creator(( 
=(( 
await(( 
userService((  +
.((+ , 
GetCreatorByUserName((, @
(((@ A
name((A E
)((E F
;((F G
var)) 
result)) 
=)) 
await)) 
	_database)) (
.))( )
PostPost))) 1
())1 2
post))2 6
,))6 7
creator))8 ?
)))? @
;))@ A
if** 
(** 
!** 
result** 
)** 
return++ 

BadRequest++ !
(++! "
result++" (
)++( )
;++) *
return,, 
Ok,, 
(,, 
result,, 
),, 
;,, 
}-- 	
[// 	

HttpDelete//	 
(// 
$str// 
)// 
]// 
public00 
async00 
Task00 
<00 
ActionResult00 &
<00& '
bool00' +
>00+ ,
>00, -

DeletePost00. 8
(008 9
long009 =
id00> @
)00@ A
{11 	
var22 
result22 
=22 
await22 
	_database22 (
.22( )

DeletePost22) 3
(223 4
id224 6
)226 7
;227 8
if33 
(33 
!33 
result33 
)33 
return44 

BadRequest44 !
(44! "
result44" (
)44( )
;44) *
return55 
Ok55 
(55 
result55 
)55 
;55 
}66 	
[88 	
HttpPut88	 
(88 
$str88 
)88 
]88 
public99 
async99 
Task99 
<99 
ActionResult99 &
<99& '
bool99' +
>99+ ,
>99, -
LikePost99. 6
(996 7
Post997 ;
post99< @
)99@ A
{:: 	
var;; 
result;; 
=;; 
await;; 
	_database;; (
.;;( )
LikePost;;) 1
(;;1 2
post;;2 6
);;6 7
;;;7 8
if== 
(== 
!== 
result== 
)== 
return>> 

BadRequest>> !
(>>! "
result>>" (
)>>( )
;>>) *
return?? 
Ok?? 
(?? 
result?? 
)?? 
;?? 
}@@ 	
[BB 	
HttpPutBB	 
(BB 
$strBB  
)BB  !
]BB! "
publicCC 
asyncCC 
TaskCC 
<CC 
ActionResultCC &
<CC& '
boolCC' +
>CC+ ,
>CC, -

RemoveLikeCC. 8
(CC8 9
longCC9 =
idCC> @
)CC@ A
{DD 	
varEE 
resultEE 
=EE 
awaitEE 
	_databaseEE (
.EE( )

RemoveLikeEE) 3
(EE3 4
idEE4 6
)EE6 7
;EE7 8
ifFF 
(FF 
!FF 
resultFF 
)FF 
returnGG 

BadRequestGG !
(GG! "
resultGG" (
)GG( )
;GG) *
returnHH 
OkHH 
(HH 
resultHH 
)HH 
;HH 
}II 	
}JJ 
}KK ¢
6D:\Fontys\S3\API\API\Controllers\ReactionController.cs
	namespace

 	
API


 
.

 
Controllers

 
{ 
[ 
Route 

(
 
$str 
) 
] 
[ 
ApiController 
] 
public 

class 
ReactionController #
:$ %
ControllerBase& 4
{ 
private 
readonly 
IReactionDatabase *
	_database+ 4
;4 5
private 
readonly 
UserService $
userService% 0
;0 1
public 
ReactionController !
(! "
IReactionDatabase" 3
database4 <
,< =
UserService> I
userServiceJ U
)U V
{ 	
this 
. 
userService 
= 
userService *
;* +
	_database 
= 
database  
;  !
} 	
[ 	
HttpPost	 
] 
public 
async 
Task 
< 
ActionResult &
<& '
bool' +
>+ ,
>, -
PostReaction. :
(: ;
[; <
FromBody< D
]D E
ReactionF N
reactionO W
)W X
{ 	
var 
name 
= 
User 
. 
Claims "
." #
Where# (
(( )
i) *
=>+ -
i. /
./ 0
Type0 4
==5 7
$str8 >
)> ?
.? @
FirstOrDefault@ N
(N O
)O P
.P Q
ValueQ V
;V W
Fan 
fan 
= 
await 
userService '
.' (
GetFanByUsername( 8
(8 9
name9 =
)= >
;> ?
var 
result 
= 
await 
	_database (
.( )
PostReaction) 5
(5 6
reaction6 >
,> ?
reaction@ H
.H I
PostIdI O
,O P
fanQ T
.T U
IdU W
)W X
;X Y
if 
( 
! 
result 
) 
return   

BadRequest   !
(  ! "
result  " (
)  ( )
;  ) *
return!! 
Ok!! 
(!! 
result!! 
)!! 
;!! 
}"" 	
}## 
}$$ ˘
6D:\Fontys\S3\API\API\Controllers\RegisterController.cs
	namespace 	
API
 
. 
Controllers 
{ 
[ 
Route 

(
 
$str 
) 
] 
[ 
ApiController 
] 
[ 
AllowAnonymous 
] 
public 

class 
RegisterController #
:$ %
ControllerBase& 4
{ 
private 
readonly 
IRegisterDatabase *
	_database+ 4
;4 5
public 
RegisterController !
(! "
IRegisterDatabase" 3
database4 <
)< =
{ 	
	_database 
= 
database  
;  !
} 	
[ 	
HttpPost	 
( 
$str 
) 
] 
public 
async 
Task 
< 
ActionResult &
<& '
bool' +
>+ ,
>, -
PostCreatorAccount. @
(@ A
[A B
FromBodyB J
]J K
CreatorL S
creatorT [
)[ \
{ 	
var 
result 
= 
await 
	_database (
.( )
PostCreatorAccount) ;
(; <
creator< C
)C D
;D E
if 
( 
! 
result 
) 
return 

BadRequest !
(! "
result" (
)( )
;) *
return 
Ok 
( 
result 
) 
; 
}   	
["" 	
HttpPost""	 
("" 
$str"" 
)"" 
]"" 
public## 
async## 
Task## 
<## 
ActionResult## &
<##& '
bool##' +
>##+ ,
>##, -
PostFanAccount##. <
(##< =
[##= >
FromBody##> F
]##F G
Fan##H K
fan##L O
)##O P
{$$ 	
var%% 
user%% 
=%% 
new%% 
IdentityUser%% '
{&& 
Email'' 
='' 
fan'' 
.'' 
Email'' !
.''! "
Trim''" &
(''& '
)''' (
,''( )
UserName(( 
=(( 
fan(( 
.(( 
Username(( '
.((' (
Trim((( ,
(((, -
)((- .
})) 
;)) 
var++ 
result++ 
=++ 
await++ 
	_database++ (
.++( )
PostFanAccount++) 7
(++7 8
fan++8 ;
)++; <
;++< =
if,, 
(,, 
!,, 
result,, 
),, 
return-- 

BadRequest-- !
(--! "
result--" (
)--( )
;--) *
return.. 
Ok.. 
(.. 
result.. 
).. 
;.. 
}// 	
}00 
}11 ·
6D:\Fontys\S3\API\API\Controllers\SaveLikeController.cs
	namespace 	
API
 
. 
Controllers 
{ 
[ 
	Authorize 
] 
[ 
Route 

(
 
$str 
) 
] 
[ 
ApiController 
] 
public 

class 
SaveLikeController #
:$ %
ControllerBase& 4
{ 
private 
readonly 
ILikePostsDatabase +
	_database, 5
;5 6
private 
readonly 
UserService $
userService% 0
;0 1
public 
SaveLikeController !
(" #
ILikePostsDatabase# 5
database6 >
,> ?
UserService@ K
userServiceL W
)W X
{ 	
	_database 
= 
database  
;  !
this 
. 
userService 
= 
userService *
;* +
} 	
[ 	
HttpPost	 
] 
public 
async 
Task 
< 
ActionResult &
<& '
bool' +
>+ ,
>, -
SaveLike. 6
(6 7
Post7 ;

likedPosts< F
)F G
{ 	
var 
name 
= 
User 
. 
Claims "
." #
Where# (
(( )
i) *
=>+ -
i. /
./ 0
Type0 4
==5 7
$str8 >
)> ?
.? @
FirstOrDefault@ N
(N O
)O P
.P Q
ValueQ V
;V W
Fan 
fan 
= 
await 
userService '
.' (
GetFanByUsername( 8
(8 9
name9 =
)= >
;> ?
var   
result   
=   
await   
	_database   (
.  ( )

PostILiked  ) 3
(  3 4

likedPosts  4 >
,  > ?
fan  @ C
.  C D
Id  D F
)  F G
;  G H
if!! 
(!! 
result!! 
)!! 
return"" 
true"" 
;"" 
return## 
false## 
;## 
}$$ 	
}%% 
}&& Â 
3D:\Fontys\S3\API\API\Controllers\TokenController.cs
	namespace 	
API
 
. 
Controllers 
{ 
[ 
	Authorize 
] 
[ 
Route 

(
 
$str 
) 
] 
[ 
ApiController 
] 
public 

class 
TokenController  
:! "
ControllerBase# 1
{ 
private 
readonly 
ITokenDatabase '
	_database( 1
;1 2
private 
readonly 
UserService $
userService% 0
;0 1
public 
TokenController 
( 
ITokenDatabase -
database. 6
,6 7
UserService8 C
userServiceD O
)O P
{ 	
	_database 
= 
database  
;  !
this 
. 
userService 
= 
userService *
;* +
} 	
[ 	
HttpPut	 
] 
public 
async 
Task 
< 
ActionResult &
<& '
bool' +
>+ ,
>, -

PostTokens. 8
(8 9
[9 :
FromBody: B
]B C
BuyTokensModelC Q
buyTokensModelR `
)` a
{ 	
var 
name 
= 
User 
. 
Claims "
." #
Where# (
(( )
i) *
=>+ -
i. /
./ 0
Type0 4
==5 7
$str8 >
)> ?
.? @
FirstOrDefault@ N
(N O
)O P
.P Q
ValueQ V
;V W
Fan   
fan   
=   
await   
userService   '
.  ' (
GetFanByUsername  ( 8
(  8 9
name  9 =
)  = >
;  > ?
buyTokensModel!! 
.!! 
FanId!!  
=!!! "
fan!!# &
.!!& '
Id!!' )
;!!) *
var"" 
result"" 
="" 
await"" 
	_database"" (
.""( )
	BuyTokens"") 2
(""2 3
buyTokensModel""3 A
)""A B
;""B C
if## 
(## 
result## 
)## 
return$$ 
true$$ 
;$$ 
return%% 
false%% 
;%% 
}&& 	
[(( 	
HttpPut((	 
((( 
$str(( 
)(( 
](( 
public)) 
async)) 
Task)) 
<)) 
ActionResult)) &
<))& '
bool))' +
>))+ ,
>)), -
DonateTokens)). :
()): ;
DonateTokensModel)); L
donateTokensModel))M ^
)))^ _
{** 	
var++ 
name++ 
=++ 
User++ 
.++ 
Claims++ "
.++" #
Where++# (
(++( )
i++) *
=>+++ -
i++. /
.++/ 0
Type++0 4
==++5 7
$str++8 >
)++> ?
.++? @
FirstOrDefault++@ N
(++N O
)++O P
.++P Q
Value++Q V
;++V W
Fan,, 
fan,, 
=,, 
await,, 
userService,, '
.,,' (
GetFanByUsername,,( 8
(,,8 9
name,,9 =
),,= >
;,,> ?
donateTokensModel-- 
.-- 
FanId-- #
=--$ %
fan--& )
.--) *
Id--* ,
;--, -
var.. 
result.. 
=.. 
await.. 
	_database.. (
...( )
DonateTokens..) 5
(..5 6
donateTokensModel..6 G
)..G H
;..H I
if// 
(// 
result// 
)// 
return00 
true00 
;00 
return11 
false11 
;11 
}22 	
}33 
}44 	
D:\Fontys\S3\API\API\Program.cs
	namespace

 	
API


 
{ 
public 

class 
Program 
{ 
public 
static 
void 
Main 
(  
string  &
[& '
]' (
args) -
)- .
{ 	
CreateHostBuilder 
( 
args "
)" #
.# $
Build$ )
() *
)* +
.+ ,
Run, /
(/ 0
)0 1
;1 2
} 	
public 
static 
IHostBuilder "
CreateHostBuilder# 4
(4 5
string5 ;
[; <
]< =
args> B
)B C
=>D F
Host 
.  
CreateDefaultBuilder %
(% &
args& *
)* +
. $
ConfigureWebHostDefaults )
() *

webBuilder* 4
=>5 7
{ 

webBuilder 
. 

UseStartup )
<) *
Startup* 1
>1 2
(2 3
)3 4
;4 5
} 
) 
; 
} 
} ú
9D:\Fontys\S3\API\API\Security\JwtAuthenticationManager.cs
	namespace 	
API
 
. 
Security 
{ 
public 

static 
class $
JwtAuthenticationManager 0
{ 
public 
static 
string 
GenerateJwtToken -
(- .
IdentityUser/ ;
user< @
,@ A
stringB H
roleI M
)M N
{ 	
var 
tokenHandler 
= 
new "#
JwtSecurityTokenHandler# :
(: ;
); <
;< =
var 
tokenKey 
= 
Encoding #
.# $
ASCII$ )
.) *
GetBytes* 2
(2 3
$str3 O
)O P
;P Q
var 
tokenDescriptor 
=  !
new" %#
SecurityTokenDescriptor& =
{ 
Subject 
= 
new 
ClaimsIdentity ,
(, -
new- 0
Claim1 6
[6 7
]7 8
{9 :
new 
Claim 
( 
$str $
,$ %
user& *
.* +
UserName+ 3
)3 4
,4 5
new 
Claim 
( 
$str %
,% &
user' +
.+ ,
Email, 1
)1 2
,2 3
new 
Claim 
( 
$str $
,$ %
role& *
)* +
} 
) 
, 
Expires 
= 
DateTime "
." #
Now# &
.& '
AddDays' .
(. /
$num/ 0
)0 1
,1 2
SigningCredentials "
=# $
new% (
SigningCredentials) ;
(; <
new  
SymmetricSecurityKey ,
(, -
tokenKey- 5
)5 6
,6 7
SecurityAlgorithms &
.& '
HmacSha256Signature' :
): ;
}   
;   
var!! 
token!! 
=!! 
tokenHandler!! $
.!!$ %
CreateToken!!% 0
(!!0 1
tokenDescriptor!!1 @
)!!@ A
;!!A B
return"" 
tokenHandler"" 
.""  

WriteToken""  *
(""* +
token""+ 0
)""0 1
;""1 2
}## 	
}$$ 
}%% Ã 
6D:\Fontys\S3\API\API\Services\AuthenticationService.cs
	namespace		 	
API		
 
.		 
Services		 
{

 
public 

class !
AuthenticationService &
{ 
private 
readonly 
UserManager $
<$ %
IdentityUser% 1
>1 2
userManager3 >
;> ?
private 
readonly 
SignInManager &
<& '
IdentityUser' 3
>3 4
signInManager5 B
;B C
public !
AuthenticationService $
($ %
UserManager% 0
<0 1
IdentityUser1 =
>= >
userManager? J
,J K
SignInManagerL Y
<Y Z
IdentityUserZ f
>f g
signInManagerh u
)u v
{ 	
this 
. 
userManager 
= 
userManager *
;* +
this 
. 
signInManager 
=  
signInManager! .
;. /
} 	
private 
async 
Task 
< 
bool 
>  
EmailExists! ,
(, -
string- 3
email4 9
)9 :
{ 	
var 
result 
= 
await 
userManager *
.* +
FindByEmailAsync+ ;
(; <
email< A
)A B
;B C
if 
( 
result 
!= 
null 
) 
return 
false 
; 
return 
true 
; 
} 	
private 
async 
Task 
< 
bool 
>  
IsPasswordCorrect! 2
(2 3

LoginModel3 =

loginModel> H
)H I
{   	
var!! 
user!! 
=!! 
await!! 
userManager!! (
.!!( )
FindByEmailAsync!!) 9
(!!9 :

loginModel!!: D
.!!D E
Email!!E J
)!!J K
;!!K L
var"" 
result"" 
="" 
await"" 
signInManager"" ,
."", -$
CheckPasswordSignInAsync""- E
(""E F
user""F J
,""J K

loginModel""L V
.""V W
Password""W _
,""_ `
false""a f
)""f g
;""g h
return$$ 
result$$ 
.$$ 
	Succeeded$$ #
;$$# $
}%% 	
public'' 
async'' 
Task'' 
<'' 
string''  
>''  !
Authenticate''" .
(''. /

LoginModel''/ 9

loginModel'': D
)''D E
{(( 	
var)) 
user)) 
=)) 
await)) 
userManager)) (
.))( )
FindByEmailAsync))) 9
())9 :

loginModel)): D
.))D E
Email))E J
)))J K
;))K L
var** 
result** 
=** 
await** 
signInManager** ,
.**, -
PasswordSignInAsync**- @
(**@ A
user**A E
,**E F

loginModel**G Q
.**Q R
Password**R Z
,**Z [
false**\ a
,**a b
false**c h
)**h i
;**i j
var++ 
roles++ 
=++ 
await++ 
userManager++ )
.++) *
GetRolesAsync++* 7
(++7 8
user++8 <
)++< =
;++= >
if-- 
(-- 
result-- 
.-- 
	Succeeded--  
)--  !
return.. $
JwtAuthenticationManager.. /
.../ 0
GenerateJwtToken..0 @
(..@ A
user..A E
,..E F
roles..G L
...L M
First..M R
(..R S
)..S T
)..T U
;..U V
return// 
null// 
;// 
}00 	
}11 
}22 »%
6D:\Fontys\S3\API\API\Services\FollowDatabaseService.cs
	namespace 	
API
 
. 
Services 
{ 
public 

class !
FollowDatabaseService &
:' (
IFollowDatabase) 8
{ 
private 
readonly 
DatabaseContext (
_context) 1
;1 2
public !
FollowDatabaseService $
($ %
DatabaseContext% 4
context5 <
)< =
{ 	
_context 
= 
context 
; 
} 	
public 
async 
Task 
< 
List 
< 
CreatorFans *
>* +
>+ ,
GetFollowers- 9
(9 :
long: >
	creatorId? H
)H I
{ 	
var 
list 
= 
await 
_context %
.% &
CreatorFans& 1
.1 2
Where2 7
(7 8
i8 9
=>: <
i= >
.> ?
	CreatorId? H
==I K
	creatorIdL U
)U V
.V W
IncludeW ^
(^ _
i_ `
=>a c
id e
.e f
Fanf i
)i j
.j k
ToListAsynck v
(v w
)w x
;x y
return 
list 
; 
} 	
public 
async 
Task 
< 
List 
< 
CreatorFans *
>* +
>+ ,
GetFollowings- :
(: ;
long; ?
fanId@ E
)E F
{ 	
var 
list 
= 
await 
_context %
.% &
CreatorFans& 1
.1 2
Where2 7
(7 8
i8 9
=>: <
i= >
.> ?
FanId? D
==E G
fanIdH M
)M N
.N O
IncludeO V
(V W
iW X
=>Y [
i\ ]
.] ^
Creator^ e
)e f
.f g
ToListAsyncg r
(r s
)s t
;t u
return 
list 
; 
}   	
public"" 
async"" 
Task"" 
<"" 
bool"" 
>"" 
PostFollower""  ,
("", -
CreatorFans""- 8
model""9 >
)""> ?
{## 	
if$$ 
($$ "
CheckIfAlreadyFollowed$$ &
($$& '
model$$' ,
)$$, -
!=$$. 0
null$$1 5
)$$5 6
return%% 
false%% 
;%% 
try&& 
{'' 
_context(( 
.(( 
CreatorFans(( $
.(($ %
Add((% (
(((( )
model(() .
)((. /
;((/ 0
await)) 
_context)) 
.)) 
SaveChangesAsync)) /
())/ 0
)))0 1
;))1 2
return** 
true** 
;** 
}++ 
catch,, 
{-- 
return.. 
false.. 
;.. 
}// 
}00 	
public22 
async22 
Task22 
<22 
bool22 
>22 
DeleteFollower22  .
(22. /
CreatorFans22/ :
model22; @
)22@ A
{33 	
try44 
{55 
_context66 
.66 
CreatorFans66 $
.66$ %
Remove66% +
(66+ ,
model66, 1
)661 2
;662 3
await77 
_context77 
.77 
SaveChangesAsync77 /
(77/ 0
)770 1
;771 2
return88 
true88 
;88 
}99 
catch:: 
{;; 
return<< 
false<< 
;<< 
}== 
}>> 	
private@@ 
CreatorFans@@ "
CheckIfAlreadyFollowed@@ 2
(@@2 3
CreatorFans@@3 >
model@@? D
)@@D E
{AA 	
returnBB 
_contextBB 
.BB 
CreatorFansBB '
.BB' (
WhereBB( -
(BB- .
iBB. /
=>BB0 2
iBB3 4
.BB4 5
FanIdBB5 :
==BB; =
modelBB> C
.BBC D
FanIdBBD I
&&BBJ L
iBBM N
.BBN O
	CreatorIdBBO X
==BBY [
modelBB\ a
.BBa b
	CreatorIdBBb k
)BBk l
.BBl m
FirstOrDefaultBBm {
(BB{ |
)BB| }
;BB} ~
}CC 	
}DD 
}EE ù
<D:\Fontys\S3\API\API\Services\IdentityRegistrationService.cs
	namespace 	
API
 
. 
Services 
{ 
public 

class '
IdentityRegistrationService ,
{		 
private

 
readonly

 
UserManager

 $
<

$ %
IdentityUser

% 1
>

1 2
userManager

3 >
;

> ?
public '
IdentityRegistrationService *
(* +
UserManager+ 6
<6 7
IdentityUser7 C
>C D
userManagerE P
)P Q
{ 	
this 
. 
userManager 
= 
userManager *
;* +
} 	
public 
async 
Task 
< 
bool 
> 
DoesEmailExist  .
(. /
string/ 5
email6 ;
); <
{ 	
if 
( 
await 
userManager !
.! "
FindByEmailAsync" 2
(2 3
email3 8
)8 9
!=: <
null= A
)A B
return 
false 
; 
return 
true 
; 
} 	
public 
async 
Task 
< 
bool 
> 
CreateIdentityUser  2
(2 3
IdentityUser3 ?
user@ D
,D E
stringF L
roleM Q
)Q R
{ 	
var 
password 
= 
$str +
;+ ,
var 
result 
= 
await 
userManager *
.* +
CreateAsync+ 6
(6 7
user7 ;
,; <
password= E
)E F
;F G
if!! 
(!! 
result!! 
.!! 
	Succeeded!!  
)!!  !
{"" 
await## 
userManager## !
.##! "
AddToRoleAsync##" 0
(##0 1
user##1 5
,##5 6
role##7 ;
)##; <
;##< =
return$$ 
true$$ 
;$$ 
}%% 
return&& 
false&& 
;&& 
}'' 	
private)) 
string)) #
RandomPasswordGenerator)) .
()). /
int))/ 2
length))3 9
)))9 :
{** 	
const++ 
string++ 
valid++ 
=++  
$str++! j
;++j k
StringBuilder,, 
res,, 
=,, 
new,,  #
StringBuilder,,$ 1
(,,1 2
),,2 3
;,,3 4
Random-- 
rnd-- 
=-- 
new-- 
Random-- #
(--# $
)--$ %
;--% &
while.. 
(.. 
$num.. 
<.. 
length.. 
--.. 
)..  
{// 
res00 
.00 
Append00 
(00 
valid00  
[00  !
rnd00! $
.00$ %
Next00% )
(00) *
valid00* /
.00/ 0
Length000 6
)006 7
]007 8
)008 9
;009 :
}11 
return22 
res22 
.22 
ToString22 
(22  
)22  !
;22! "
}33 	
}44 
}55 ∫	
;D:\Fontys\S3\API\API\Services\Interfaces\IFollowDatabase.cs
	namespace 	
API
 
. 
Services 
. 

Interfaces !
{ 
public 

	interface 
IFollowDatabase $
{		 
public

 
Task

 
<

 
bool

 
>

 
PostFollower

 &
(

& '
CreatorFans

' 2
model

3 8
)

8 9
;

9 :
public 
Task 
< 
List 
< 
CreatorFans $
>$ %
>% &
GetFollowers' 3
(3 4
long4 8
	creatorId9 B
)B C
;C D
public 
Task 
< 
List 
< 
CreatorFans $
>$ %
>% &
GetFollowings' 4
(4 5
long5 9
fanId: ?
)? @
;@ A
public 
Task 
< 
bool 
> 
DeleteFollower (
(( )
CreatorFans) 4
model5 :
): ;
;; <
} 
} ®
>D:\Fontys\S3\API\API\Services\Interfaces\ILikePostsDatabase.cs
	namespace 	
API
 
. 
Services 
. 

Interfaces !
{ 
public		 

	interface		 
ILikePostsDatabase		 '
{

 
public 
Task 
< 
bool 
> 

PostILiked $
($ %
Post% )
post* .
,. /
long0 4
fanId5 :
): ;
;; <
} 
} ©
:D:\Fontys\S3\API\API\Services\Interfaces\ILoginDatabase.cs
	namespace 	
API
 
. 
Services 
. 

Interfaces !
{ 
public 

	interface 
ILoginDatabase #
{		 
public

 
Task

 
<

 
bool

 
>

 
LoginFan

 "
(

" #
string

# )
username

* 2
,

2 3
string

4 :
password

; C
)

C D
;

D E
public 
Task 
< 
bool 
> 
LoginCreator &
(& '
string' -
username. 6
,6 7
string8 >
password? G
)G H
;H I
} 
} °

9D:\Fontys\S3\API\API\Services\Interfaces\IPostDatabase.cs
	namespace 	
API
 
. 
Services 
. 

Interfaces !
{		 
public

 

	interface

 
IPostDatabase

 "
{ 
public 
Task 
< 
bool 
> 
PostPost "
(" #
Post# '
post( ,
,, -
Creator. 5
creator6 =
)= >
;> ?
public 
Task 
< 
List 
< 
Post 
> 
> 
GetPosts  (
(( )
)) *
;* +
public 
Task 
< 
bool 
> 

DeletePost $
($ %
long% )
id* ,
), -
;- .
public 
Task 
< 
bool 
> 
LikePost "
(" #
Post# '
post( ,
), -
;- .
public 
Task 
< 
bool 
> 

RemoveLike $
($ %
long% )
id* ,
), -
;- .
} 
} Â
=D:\Fontys\S3\API\API\Services\Interfaces\IReactionDatabase.cs
	namespace 	
API
 
. 
Services 
. 

Interfaces !
{ 
public		 

	interface		 
IReactionDatabase		 &
{

 
public 
Task 
< 
bool 
> 
PostReaction &
(& '
Reaction' /
reaction0 8
,8 9
long: >
postId? E
,E F
longG K
fanIdL Q
)Q R
;R S
} 
} ¡
=D:\Fontys\S3\API\API\Services\Interfaces\IRegisterDatabase.cs
	namespace 	
API
 
. 
Services 
. 

Interfaces !
{ 
public		 

	interface		 
IRegisterDatabase		 &
{

 
public 
Task 
< 
bool 
> 
PostFanAccount (
(( )
Fan) ,
fan- 0
)0 1
;1 2
public 
Task 
< 
bool 
> 
PostCreatorAccount ,
(, -
Creator- 4
creator5 <
)< =
;= >
} 
} ⁄
:D:\Fontys\S3\API\API\Services\Interfaces\ITokenDatabase.cs
	namespace 	
API
 
. 
Services 
. 

Interfaces !
{ 
public		 

	interface		 
ITokenDatabase		 #
{

 
public 
Task 
< 
bool 
> 
	BuyTokens #
(# $
BuyTokensModel$ 2
buyTokensModel3 A
)A B
;B C
public 
Task 
< 
bool 
> 
DonateTokens &
(& '
DonateTokensModel' 8
donateTokensModel9 J
)J K
;K L
} 
} ‡
8D:\Fontys\S3\API\API\Services\LikePostDatabaseService.cs
	namespace

 	
API


 
.

 
Services

 
{ 
public 

class #
LikePostDatabaseService (
:( )
ILikePostsDatabase* <
{ 
private 
readonly 
DatabaseContext (
_context) 1
;1 2
public #
LikePostDatabaseService &
(& '
DatabaseContext' 6
context7 >
)> ?
{ 	
_context 
= 
context 
; 
} 	
public 
async 
Task 
< 
bool 
> 

PostILiked  *
(* +
Post+ /
post0 4
,4 5
long6 :
fanId; @
)@ A
{ 	
if 
( 
AlreadyLiked 
( 
post !
.! "
Id" $
,$ %
fanId& +
)+ ,
), -
return 
false 
; 

LikedPosts 

likedPosts !
=" #
new$ '

LikedPosts( 2
(2 3
)3 4
{ 
PostId 
= 
post 
. 
Id  
,  !
FanId 
= 
fanId 
} 
; 
try 
{   
_context!! 
.!! 

LikedPosts!! #
.!!# $
Add!!$ '
(!!' (

likedPosts!!( 2
)!!2 3
;!!3 4
await"" 
_context"" 
."" 
SaveChangesAsync"" /
(""/ 0
)""0 1
;""1 2
return## 
true## 
;## 
}$$ 
catch%% 
{&& 
return'' 
false'' 
;'' 
}(( 
})) 	
private++ 
bool++ 
AlreadyLiked++ !
(++! "
long++" &
postId++' -
,++- .
long++/ 3
fanId++4 9
)++9 :
{,, 	
var-- 
response-- 
=-- 
_context-- $
.--$ %

LikedPosts--% /
.--/ 0
Where--0 5
(--5 6
i--6 7
=>--8 :
i--; <
.--< =
PostId--= C
==--D F
postId--G M
&&--N P
i--Q R
.--R S
FanId--S X
==--Y [
fanId--\ a
)--a b
.--b c
FirstOrDefault--c q
(--q r
)--r s
;--s t
if.. 
(.. 
response.. 
!=.. 
null..  
)..  !
return// 
true// 
;// 
return00 
false00 
;00 
}11 	
}22 
}33 ≤

5D:\Fontys\S3\API\API\Services\LoginDatabaseService.cs
	namespace		 	
API		
 
.		 
Services		 
{

 
public 

class  
LoginDatabaseService %
:& '
ILoginDatabase( 6
{ 
private 
readonly 
DatabaseContext (
_context) 1
;1 2
public  
LoginDatabaseService #
(# $
DatabaseContext$ 3
context4 ;
); <
{ 	
_context 
= 
context 
; 
} 	
public 
async 
Task 
< 
bool 
> 
LoginFan  (
(( )
string) /
username0 8
,8 9
string: @
passwordA I
)I J
{ 	
return 
true 
; 
} 	
public 
async 
Task 
< 
bool 
> 
LoginCreator  ,
(, -
string- 3
username4 <
,< =
string> D
passwordE M
)M N
{   	
return'' 
true'' 
;'' 
}(( 	
})) 
}** Ê4
4D:\Fontys\S3\API\API\Services\PostDatabaseService.cs
	namespace

 	
API


 
.

 
Services

 
{ 
public 

class 
PostDatabaseService $
:% &
IPostDatabase' 4
{ 
private 
readonly 
DatabaseContext (
_context) 1
;1 2
public 
PostDatabaseService "
(" #
DatabaseContext# 2
context3 :
): ;
{ 	
_context 
= 
context 
; 
} 	
public 
async 
Task 
< 
List 
< 
Post #
># $
>$ %
GetPosts& .
(. /
)/ 0
{ 	
var 
list 
= 
await 
_context %
.% &
Posts& +
.+ ,
Include, 3
(3 4
i4 5
=>6 8
i9 :
.: ;
	Reactions; D
)D E
.E F
ToListAsyncF Q
(Q R
)R S
;S T
return 
list 
; 
} 	
public 
async 
Task 
< 
bool 
> 
PostPost  (
(( )
Post) -
post. 2
,2 3
Creator4 ;
creator< C
)C D
{ 	
var 
_post 
= +
CreatePostWithCorrectReferences 7
(7 8
post8 <
,< =
creator> E
)E F
;F G
try 
{   
_context!! 
.!! 
Posts!! 
.!! 
Add!! "
(!!" #
_post!!# (
)!!( )
;!!) *
await"" 
_context"" 
."" 
SaveChangesAsync"" /
(""/ 0
)""0 1
;""1 2
return## 
true## 
;## 
}$$ 
catch%% 
(%% 
	Exception%% 
e%% 
)%% 
{&& 
Console'' 
.'' 
	WriteLine'' !
(''! "
e''" #
.''# $
Message''$ +
)''+ ,
;'', -
return(( 
false(( 
;(( 
})) 
}** 	
public,, 
async,, 
Task,, 
<,, 
bool,, 
>,, 

DeletePost,,  *
(,,* +
long,,+ /
id,,0 2
),,2 3
{-- 	
try.. 
{// 
var00 
post00 
=00 
await00  
_context00! )
.00) *
Posts00* /
.00/ 0
	FindAsync000 9
(009 :
id00: <
)00< =
;00= >
_context22 
.22 
Posts22 
.22 
Remove22 %
(22% &
post22& *
)22* +
;22+ ,
await33 
_context33 
.33 
SaveChangesAsync33 /
(33/ 0
)330 1
;331 2
return44 
true44 
;44 
}55 
catch66 
(66 
	Exception66 
e66 
)66 
{77 
Console88 
.88 
	WriteLine88 !
(88! "
e88" #
.88# $
Message88$ +
)88+ ,
;88, -
return99 
false99 
;99 
}:: 
};; 	
public== 
async== 
Task== 
<== 
bool== 
>== 
LikePost==  (
(==( )
Post==) -
post==. 2
)==2 3
{>> 	
try?? 
{@@ 
varAA 
_postAA 
=AA 
awaitAA !
_contextAA" *
.AA* +
PostsAA+ 0
.AA0 1
	FindAsyncAA1 :
(AA: ;
postAA; ?
.AA? @
IdAA@ B
)AAB C
;AAC D
_postCC 
.CC 
LikesCC 
+=CC 
$numCC  
;CC  !
awaitEE 
_contextEE 
.EE 
SaveChangesAsyncEE /
(EE/ 0
)EE0 1
;EE1 2
returnFF 
trueFF 
;FF 
}GG 
catchHH 
(HH 
	ExceptionHH 
eHH 
)HH 
{II 
ConsoleJJ 
.JJ 
WriteJJ 
(JJ 
eJJ 
.JJ  
MessageJJ  '
)JJ' (
;JJ( )
returnKK 
falseKK 
;KK 
}LL 
}MM 	
publicOO 
asyncOO 
TaskOO 
<OO 
boolOO 
>OO 

RemoveLikeOO  *
(OO* +
longOO+ /
idOO0 2
)OO2 3
{PP 	
tryQQ 
{RR 
varSS 
postSS 
=SS 
awaitSS  
_contextSS! )
.SS) *
PostsSS* /
.SS/ 0
	FindAsyncSS0 9
(SS9 :
idSS: <
)SS< =
;SS= >
postUU 
.UU 
LikesUU 
-=UU 
$numUU 
;UU  
awaitVV 
_contextVV 
.VV 
SaveChangesAsyncVV /
(VV/ 0
)VV0 1
;VV1 2
returnWW 
trueWW 
;WW 
}XX 
catchYY 
(YY 
	ExceptionYY 
eYY 
)YY 
{ZZ 
Console[[ 
.[[ 
	WriteLine[[ !
([[! "
e[[" #
.[[# $
Message[[$ +
)[[+ ,
;[[, -
return\\ 
false\\ 
;\\ 
}]] 
}^^ 	
private`` 
Post`` +
CreatePostWithCorrectReferences`` 4
(``4 5
Post``5 9
post``: >
,``> ?
Creator``@ G
creator``H O
)``O P
{aa 	
postbb 
.bb 
	Reactionsbb 
=bb 
newbb  
Listbb! %
<bb% &
Reactionbb& .
>bb. /
(bb/ 0
)bb0 1
;bb1 2
postdd 
.dd 
	CreatorIddd 
=dd 
creatordd $
.dd$ %
Iddd% '
;dd' (
postee 
.ee 
CreatorUsernameee  
=ee! "
creatoree# *
.ee* +
Usernameee+ 3
;ee3 4
postff 
.ff 
Creatorff 
=ff 
nullff 
;ff  
returnhh 
posthh 
;hh 
}ii 	
}jj 
}kk Œ
8D:\Fontys\S3\API\API\Services\ReactionDatabaseService.cs
	namespace		 	
API		
 
.		 
Services		 
{

 
public 

class #
ReactionDatabaseService (
:) *
IReactionDatabase+ <
{ 
private 
readonly 
DatabaseContext (
_context) 1
;1 2
public #
ReactionDatabaseService &
(& '
DatabaseContext' 6
context7 >
)> ?
{ 	
_context 
= 
context 
; 
} 	
public 
async 
Task 
< 
bool 
> 
PostReaction  ,
(, -
Reaction- 5
reaction6 >
,> ?
long@ D
postIdE K
,K L
longM Q
fanIdR W
)W X
{ 	
var 
	_reaction 
= /
#CreateReactionWithCorrectReferences ?
(? @
reaction@ H
,H I
postIdJ P
,P Q
fanIdR W
)W X
;X Y
try 
{ 
_context 
. 
	Reactions "
." #
Add# &
(& '
	_reaction' 0
)0 1
;1 2
await 
_context 
. 
SaveChangesAsync /
(/ 0
)0 1
;1 2
return 
true 
; 
} 
catch 
( 
	Exception 
e 
) 
{ 
Console 
. 
	WriteLine !
(! "
e" #
.# $
Message$ +
)+ ,
;, -
Console   
.   
	WriteLine   !
(  ! "
e  " #
.  # $
InnerException  $ 2
)  2 3
;  3 4
return!! 
false!! 
;!! 
}"" 
}## 	
private%% 
Reaction%% /
#CreateReactionWithCorrectReferences%% <
(%%< =
Reaction%%= E
reaction%%F N
,%%N O
long%%P T
postId%%U [
,%%[ \
long%%] a
fanId%%b g
)%%g h
{&& 	
reaction'' 
.'' 
FanId'' 
='' 
fanId'' "
;''" #
reaction(( 
.(( 
PostId(( 
=(( 
postId(( $
;(($ %
reaction)) 
.)) 
Post)) 
=)) 
null))  
;))  !
reaction** 
.** 
Fan** 
=** 
null** 
;**  
return,, 
reaction,, 
;,, 
}-- 	
}.. 
}// Ë1
8D:\Fontys\S3\API\API\Services\RegisterDatabaseService.cs
	namespace 	
API
 
. 
Services 
{ 
public 

class #
RegisterDatabaseService (
:) *
IRegisterDatabase+ <
{ 
private 
readonly 
DatabaseContext (
_context) 1
;1 2
private 
readonly '
IdentityRegistrationService 4'
identityRegistrationService5 P
;P Q
public #
RegisterDatabaseService &
(& '
DatabaseContext' 6
context7 >
,> ?'
IdentityRegistrationService@ ['
identityRegistrationService\ w
)w x
{ 	
_context 
= 
context 
; 
this 
. '
identityRegistrationService ,
=- .'
identityRegistrationService/ J
;J K
} 	
public 
async 
Task 
< 
bool 
> 
PostFanAccount  .
(. /
Fan/ 2
fan3 6
)6 7
{ 	
var 
_fan 
= 
	CreateFan  
(  !
fan! $
)$ %
;% &
var 
user 
= 
new 
IdentityUser '
{ 
Email 
= 
fan 
. 
Email !
.! "
Trim" &
(& '
)' (
,( )
UserName 
= 
fan 
. 
Username '
.' (
Trim( ,
(, -
)- .
}   
;   
if"" 
("" 
!"" 
await"" '
identityRegistrationService"" 2
.""2 3
DoesEmailExist""3 A
(""A B
fan""B E
.""E F
Email""F K
)""K L
)""L M
return## 
false## 
;## 
if$$ 
($$ 
await$$ '
identityRegistrationService$$ 1
.$$1 2
CreateIdentityUser$$2 D
($$D E
user$$E I
,$$I J
$str$$K P
)$$P Q
)$$Q R
{%% 
_context&& 
.&& 
Fans&& 
.&& 
Add&& !
(&&! "
_fan&&" &
)&&& '
;&&' (
await'' 
_context'' 
.'' 
SaveChangesAsync'' /
(''/ 0
)''0 1
;''1 2
}(( 
return)) 
true)) 
;)) 
}++ 	
public-- 
async-- 
Task-- 
<-- 
bool-- 
>-- 
PostCreatorAccount--  2
(--2 3
Creator--3 :
creator--; B
)--B C
{.. 	
var// 
_creator// 
=// 
CreateCreator// (
(//( )
creator//) 0
)//0 1
;//1 2
var11 
user11 
=11 
new11 
IdentityUser11 '
{22 
Email33 
=33 
creator33 
.33  
Email33  %
.33% &
Trim33& *
(33* +
)33+ ,
,33, -
UserName44 
=44 
creator44 "
.44" #
Username44# +
.44+ ,
Trim44, 0
(440 1
)441 2
}55 
;55 
if77 
(77 
!77 
await77 '
identityRegistrationService77 2
.772 3
DoesEmailExist773 A
(77A B
creator77B I
.77I J
Email77J O
)77O P
)77P Q
return88 
false88 
;88 
if99 
(99 
await99 '
identityRegistrationService99 1
.991 2
CreateIdentityUser992 D
(99D E
user99E I
,99I J
$str99K T
)99T U
)99U V
{:: 
_context;; 
.;; 
Creators;; !
.;;! "
Add;;" %
(;;% &
_creator;;& .
);;. /
;;;/ 0
await<< 
_context<< 
.<< 
SaveChangesAsync<< /
(<</ 0
)<<0 1
;<<1 2
}== 
return>> 
true>> 
;>> 
}?? 	
privateAA 
FanAA 
	CreateFanAA 
(AA 
FanAA !
fanAA" %
)AA% &
{BB 	
fanCC 
.CC 
CreatorFansCC 
=CC 
newCC !
ListCC" &
<CC& '
CreatorFansCC' 2
>CC2 3
(CC3 4
)CC4 5
;CC5 6
fanDD 
.DD 

LikedPostsDD 
=DD 
newDD  
ListDD! %
<DD% &

LikedPostsDD& 0
>DD0 1
(DD1 2
)DD2 3
;DD3 4
fanEE 
.EE 

SavedPostsEE 
=EE 
newEE  
ListEE! %
<EE% &

SavedPostsEE& 0
>EE0 1
(EE1 2
)EE2 3
;EE3 4
fanFF 
.FF 
	ReactionsFF 
=FF 
newFF 
ListFF  $
<FF$ %
ReactionFF% -
>FF- .
(FF. /
)FF/ 0
;FF0 1
returnHH 
fanHH 
;HH 
}II 	
privateKK 
CreatorKK 
CreateCreatorKK %
(KK% &
CreatorKK& -
creatorKK. 5
)KK5 6
{LL 	
creatorMM 
.MM 

BannedFansMM 
=MM  
newMM! $
ListMM% )
<MM) *
FanMM* -
>MM- .
(MM. /
)MM/ 0
;MM0 1
creatorNN 
.NN 
	FollowersNN 
=NN 
newNN  #
ListNN$ (
<NN( )
CreatorFansNN) 4
>NN4 5
(NN5 6
)NN6 7
;NN7 8
creatorOO 
.OO 
PostsOO 
=OO 
newOO 
ListOO  $
<OO$ %
PostOO% )
>OO) *
(OO* +
)OO+ ,
;OO, -
returnQQ 
creatorQQ 
;QQ 
}RR 	
}TT 
}UU Ø
5D:\Fontys\S3\API\API\Services\TokenDatabaseService.cs
	namespace

 	
API


 
.

 
Services

 
{ 
public 

class  
TokenDatabaseService %
:% &
ITokenDatabase' 5
{ 
private 
readonly 
DatabaseContext (
	_database) 2
;2 3
private 
readonly 
UserService $
userService% 0
;0 1
public  
TokenDatabaseService #
(# $
DatabaseContext$ 3
database4 <
,< =
UserService> I
userServiceJ U
)U V
{ 	
	_database 
= 
database  
;  !
this 
. 
userService 
= 
userService *
;* +
} 	
public 
async 
Task 
< 
bool 
> 
	BuyTokens  )
() *
BuyTokensModel* 8
buyTokensModel9 G
)G H
{ 	
Fan 
fan 
= 
await 
userService '
.' (

GetFanById( 2
(2 3
buyTokensModel3 A
.A B
FanIdB G
)G H
;H I
fan 
. 
Tokens 
+= 
buyTokensModel (
.( )
Amount) /
;/ 0
try 
{ 
	_database 
. 
Fans 
. 
Update %
(% &
fan& )
)) *
;* +
await 
	_database 
.  
SaveChangesAsync  0
(0 1
)1 2
;2 3
return   
true   
;   
}!! 
catch"" 
{## 
return$$ 
false$$ 
;$$ 
}%% 
}&& 	
public(( 
async(( 
Task(( 
<(( 
bool(( 
>(( 
DonateTokens((  ,
(((, -
DonateTokensModel((- >
donateTokensModel((? P
)((P Q
{)) 	
Fan** 
fan** 
=** 
await** 
userService** '
.**' (

GetFanById**( 2
(**2 3
donateTokensModel**3 D
.**D E
FanId**E J
)**J K
;**K L
Creator++ 
creator++ 
=++ 
await++ #
userService++$ /
.++/ 0
GetCreatorById++0 >
(++> ?
donateTokensModel++? P
.++P Q
	CreatorId++Q Z
)++Z [
;++[ \
fan-- 
.-- 
Tokens-- 
-=-- 
donateTokensModel-- +
.--+ ,
Amount--, 2
;--2 3
creator.. 
... 
Tokens.. 
+=.. 
donateTokensModel.. /
.../ 0
Amount..0 6
;..6 7
try00 
{11 
	_database22 
.22 
Fans22 
.22 
Update22 %
(22% &
fan22& )
)22) *
;22* +
	_database33 
.33 
Creators33 "
.33" #
Update33# )
(33) *
creator33* 1
)331 2
;332 3
await55 
	_database55 
.55  
SaveChangesAsync55  0
(550 1
)551 2
;552 3
return66 
true66 
;66 
}77 
catch88 
{99 
return:: 
false:: 
;:: 
};; 
}<< 	
}== 
}>> ¶
,D:\Fontys\S3\API\API\Services\UserService.cs
	namespace		 	
API		
 
.		 
Services		 
{

 
public 

class 
UserService 
{ 
private 
readonly 
DatabaseContext (
_context) 1
;1 2
public 
UserService 
( 
DatabaseContext *
context+ 2
)2 3
{ 	
_context 
= 
context 
; 
} 	
public 
async 
Task 
< 
Creator !
>! " 
GetCreatorByUserName# 7
(7 8
string8 >
username? G
)G H
{ 	
return 
await 
_context !
.! "
Creators" *
.* +
Where+ 0
(0 1
i1 2
=>3 5
i6 7
.7 8
Username8 @
==A C
usernameD L
)L M
.M N
FirstOrDefaultAsyncN a
(a b
)b c
;c d
} 	
public 
async 
Task 
< 
Creator !
>! "
GetCreatorById# 1
(1 2
long2 6
id7 9
)9 :
{ 	
return 
await 
_context !
.! "
Creators" *
.* +
Where+ 0
(0 1
i1 2
=>3 5
i6 7
.7 8
Id8 :
==; =
id> @
)@ A
.A B
FirstOrDefaultAsyncB U
(U V
)V W
;W X
} 	
public 
async 
Task 
< 
Fan 
> 
GetFanByUsername /
(/ 0
string0 6
username7 ?
)? @
{ 	
return   
await   
_context   !
.  ! "
Fans  " &
.  & '
Where  ' ,
(  , -
i  - .
=>  / 1
i  2 3
.  3 4
Username  4 <
==  = ?
username  @ H
)  H I
.  I J
FirstOrDefaultAsync  J ]
(  ] ^
)  ^ _
;  _ `
}!! 	
public"" 
async"" 
Task"" 
<"" 
Fan"" 
>"" 

GetFanById"" )
("") *
long""* .
id""/ 1
)""1 2
{## 	
return$$ 
await$$ 
_context$$ !
.$$! "
Fans$$" &
.$$& '
Where$$' ,
($$, -
i$$- .
=>$$/ 1
i$$2 3
.$$3 4
Id$$4 6
==$$7 9
id$$: <
)$$< =
.$$= >
FirstOrDefaultAsync$$> Q
($$Q R
)$$R S
;$$S T
}%% 	
}&& 
}'' ·j
D:\Fontys\S3\API\API\Startup.cs
	namespace 	
API
 
{ 
public 

class 
Startup 
{ 
public 
Startup 
( 
IConfiguration %
configuration& 3
)3 4
{ 	
Configuration 
= 
configuration )
;) *
} 	
public 
IConfiguration 
Configuration +
{, -
get. 1
;1 2
}3 4
public 
string ,
 IdentityDatabaseConnectionString 6
{7 8
get9 <
;< =
set> A
;A B
}C D
readonly 
string "
MyAllowSpecificOrigins .
=/ 0
$str1 J
;J K
public"" 
void"" 
ConfigureServices"" %
(""% &
IServiceCollection""& 8
services""9 A
)""A B
{## 	
services$$ 
.$$ 
AddCors$$ 
($$ 
options$$ $
=>$$% '
{%% 
options&& 
.&& 
	AddPolicy&& !
(&&! "
name&&" &
:&&& '"
MyAllowSpecificOrigins&&( >
,&&> ?
builder'' 
=>'' 
{(( 
builder)) 
.** 
AllowAnyOrigin** '
(**' (
)**( )
.++ 
AllowAnyMethod++ '
(++' (
)++( )
.,, 
AllowAnyHeader,, '
(,,' (
),,( )
;,,) *
}-- 
)-- 
;-- 
}.. 
).. 
;.. 
services00 
.00 
	Configure00 
<00 
FormOptions00 *
>00* +
(00+ ,
o00, -
=>00. 0
{11 
o22 
.22 
ValueLengthLimit22 "
=22# $
int22% (
.22( )
MaxValue22) 1
;221 2
o33 
.33 $
MultipartBodyLengthLimit33 *
=33+ ,
int33- 0
.330 1
MaxValue331 9
;339 :
o44 
.44 !
MemoryBufferThreshold44 '
=44( )
int44* -
.44- .
MaxValue44. 6
;446 7
}55 
)55 
;55 
services77 
.77 
AddControllers77 #
(77# $
)77$ %
.88 
AddNewtonsoftJson88 "
(88" #
options88# *
=>88+ -
{99 
options:: 
.:: 
SerializerSettings:: .
.::. /!
ReferenceLoopHandling::/ D
=::E F!
ReferenceLoopHandling::G \
.::\ ]
Ignore::] c
;::c d
};; 
);; 
;;; 
services== 
.== 
AddDbContext== !
<==! "
DatabaseContext==" 1
>==1 2
(==2 3
options==3 :
=>==; =
{>> 
options?? 
.?? 
UseMySQL??  
(??  !
Configuration??! .
.??. /
GetConnectionString??/ B
(??B C
$str??C L
)??L M
)??M N
;??N O
}@@ 
)@@ 
;@@ 
servicesAA 
.AA 
AddControllersAA #
(AA# $
)AA$ %
;AA% &
servicesBB 
.BB 
AddSwaggerGenBB "
(BB" #
cBB# $
=>BB% '
{CC 
cDD 
.DD 

SwaggerDocDD 
(DD 
$strDD !
,DD! "
newDD# &
OpenApiInfoDD' 2
{DD3 4
TitleDD5 :
=DD; <
$strDD= B
,DDB C
VersionDDD K
=DDL M
$strDDN R
}DDS T
)DDT U
;DDU V
}EE 
)EE 
;EE ,
 IdentityDatabaseConnectionStringHH ,
=HH- .
ConfigurationHH/ <
.HH< =
GetConnectionStringHH= P
(HHP Q
$strHHQ c
)HHc d
;HHd e
servicesJJ 
.JJ 
AddDbContextJJ !
<JJ! "#
IdentityDatabaseContextJJ" 9
>JJ9 :
(JJ: ;
optionsJJ; B
=>JJC E
optionsJJF M
.JJM N
UseMySqlJJN V
(JJV W,
 IdentityDatabaseConnectionStringJJW w
,JJw x
ServerVersionKK 
.KK 

AutoDetectKK (
(KK( ),
 IdentityDatabaseConnectionStringKK) I
)KKI J
)KKJ K
)KKK L
;KKL M
servicesMM 
.MM 
AddIdentityMM  
<MM  !
IdentityUserMM! -
,MM- .
IdentityRoleMM/ ;
>MM; <
(MM< =
optionsMM= D
=>MME G
{NN 
optionsQQ 
.QQ 
PasswordQQ  
.QQ  !
RequiredLengthQQ! /
=QQ0 1
$numQQ2 3
;QQ3 4
optionsRR 
.RR 
PasswordRR  
.RR  !
RequireDigitRR! -
=RR. /
trueRR0 4
;RR4 5
optionsSS 
.SS 
PasswordSS  
.SS  !
RequireUppercaseSS! 1
=SS2 3
trueSS4 8
;SS8 9
optionsTT 
.TT 
PasswordTT  
.TT  !
RequiredUniqueCharsTT! 4
=TT5 6
$numTT7 8
;TT8 9
optionsUU 
.UU 
PasswordUU  
.UU  !
RequireLowercaseUU! 1
=UU2 3
trueUU4 8
;UU8 9
}VV 
)VV 
.VV $
AddEntityFrameworkStoresVV '
<VV' (#
IdentityDatabaseContextVV( ?
>VV? @
(VV@ A
)VVA B
.WW $
AddDefaultTokenProvidersWW (
(WW( )
)WW) *
;WW* +
servicesYY 
.YY 
AddAuthenticationYY &
(YY& '
xYY' (
=>YY) +
{ZZ 
x[[ 
.[[ %
DefaultAuthenticateScheme[[ +
=[[, -
JwtBearerDefaults[[. ?
.[[? @ 
AuthenticationScheme[[@ T
;[[T U
x\\ 
.\\ "
DefaultChallengeScheme\\ (
=\\) *
JwtBearerDefaults\\+ <
.\\< = 
AuthenticationScheme\\= Q
;\\Q R
}]] 
)]] 
.]] 
AddJwtBearer]] 
(]] 
x]] 
=>]]  
{^^ 
x__ 
.__  
RequireHttpsMetadata__ &
=__' (
false__) .
;__. /
x`` 
.`` 
	SaveToken`` 
=`` 
true`` "
;``" #
xaa 
.aa %
TokenValidationParametersaa +
=aa, -
newaa. 1%
TokenValidationParametersaa2 K
{aaL M$
ValidateIssuerSigningKeybb ,
=bb- .
truebb/ 3
,bb3 4
IssuerSigningKeycc $
=cc% &
newcc' * 
SymmetricSecurityKeycc+ ?
(cc? @
Encodingcc@ H
.ccH I
ASCIIccI N
.ccN O
GetBytesccO W
(ccW X
$strccX t
)cct u
)ccu v
,ccv w
ValidateIssuerdd "
=dd# $
falsedd% *
,dd* +
ValidateAudienceee $
=ee% &
falseee' ,
}ff 
;ff 
}gg 
)gg 
;gg 
servicesii 
.ii 
AddTransientii !
<ii! "
IRegisterDatabaseii" 3
,ii3 4#
RegisterDatabaseServiceii5 L
>iiL M
(iiM N
)iiN O
;iiO P
servicesjj 
.jj 
AddTransientjj !
<jj! "
ILoginDatabasejj" 0
,jj0 1 
LoginDatabaseServicejj2 F
>jjF G
(jjG H
)jjH I
;jjI J
serviceskk 
.kk 
AddTransientkk !
<kk! "
IPostDatabasekk" /
,kk/ 0
PostDatabaseServicekk1 D
>kkD E
(kkE F
)kkF G
;kkG H
servicesll 
.ll 
AddTransientll !
<ll! "
IReactionDatabasell" 3
,ll3 4#
ReactionDatabaseServicell5 L
>llL M
(llM N
)llN O
;llO P
servicesmm 
.mm 
AddTransientmm !
<mm! "
ILikePostsDatabasemm" 4
,mm4 5#
LikePostDatabaseServicemm6 M
>mmM N
(mmN O
)mmO P
;mmP Q
servicesnn 
.nn 
AddTransientnn !
<nn! "
ITokenDatabasenn" 0
,nn0 1 
TokenDatabaseServicenn2 F
>nnF G
(nnG H
)nnH I
;nnI J
servicesoo 
.oo 
AddTransientoo !
<oo! "
IFollowDatabaseoo" 1
,oo1 2!
FollowDatabaseServiceoo3 H
>ooH I
(ooI J
)ooJ K
;ooK L
servicesrr 
.rr 
AddTransientrr !
<rr! "'
IdentityRegistrationServicerr" =
>rr= >
(rr> ?
)rr? @
;rr@ A
servicesss 
.ss 
AddTransientss !
<ss! "!
AuthenticationServicess" 7
>ss7 8
(ss8 9
)ss9 :
;ss: ;
servicestt 
.tt 
AddTransienttt !
<tt! "
UserServicett" -
>tt- .
(tt. /
)tt/ 0
;tt0 1
}vv 	
publicyy 
voidyy 
	Configureyy 
(yy 
IApplicationBuilderyy 1
appyy2 5
,yy5 6
IWebHostEnvironmentyy7 J
envyyK N
,yyN O
IServiceProvideryyP `
serviceProvideryya p
)yyp q
{zz 	
app{{ 
.{{ 
UseCors{{ 
({{ "
MyAllowSpecificOrigins{{ .
){{. /
;{{/ 0
if|| 
(|| 
env|| 
.|| 
IsDevelopment|| !
(||! "
)||" #
)||# $
{}} 
app~~ 
.~~ %
UseDeveloperExceptionPage~~ -
(~~- .
)~~. /
;~~/ 0
app 
. 

UseSwagger 
( 
)  
;  !
app
ÄÄ 
.
ÄÄ 
UseSwaggerUI
ÄÄ  
(
ÄÄ  !
c
ÄÄ! "
=>
ÄÄ# %
c
ÄÄ& '
.
ÄÄ' (
SwaggerEndpoint
ÄÄ( 7
(
ÄÄ7 8
$str
ÄÄ8 R
,
ÄÄR S
$str
ÄÄT \
)
ÄÄ\ ]
)
ÄÄ] ^
;
ÄÄ^ _
}
ÅÅ 
app
ÉÉ 
.
ÉÉ !
UseHttpsRedirection
ÉÉ #
(
ÉÉ# $
)
ÉÉ$ %
;
ÉÉ% &
app
ÖÖ 
.
ÖÖ 

UseRouting
ÖÖ 
(
ÖÖ 
)
ÖÖ 
;
ÖÖ 
app
áá 
.
áá 
UseAuthentication
áá !
(
áá! "
)
áá" #
;
áá# $
app
ââ 
.
ââ 
UseAuthorization
ââ  
(
ââ  !
)
ââ! "
;
ââ" #
app
ãã 
.
ãã 
UseStaticFiles
ãã 
(
ãã 
)
ãã  
;
ãã  !
app
êê 
.
êê 
UseEndpoints
êê 
(
êê 
	endpoints
êê &
=>
êê' )
{
ëë 
	endpoints
íí 
.
íí 
MapControllers
íí (
(
íí( )
)
íí) *
;
íí* +
}
ìì 
)
ìì 
;
ìì 
Init
ïï 
(
ïï 
serviceProvider
ïï  
)
ïï  !
.
ïï! "
Wait
ïï" &
(
ïï& '
)
ïï' (
;
ïï( )
}
óó 	
private
ôô 
static
ôô 
async
ôô 
Task
ôô !
Init
ôô" &
(
ôô& '
IServiceProvider
ôô' 7
serviceProvider
ôô8 G
)
ôôG H
{
öö 	
var
õõ 
roleManager
õõ 
=
õõ 
serviceProvider
õõ -
.
õõ- . 
GetRequiredService
õõ. @
<
õõ@ A
RoleManager
õõA L
<
õõL M
IdentityRole
õõM Y
>
õõY Z
>
õõZ [
(
õõ[ \
)
õõ\ ]
;
õõ] ^
if
ûû 
(
ûû 
!
ûû 
await
ûû 
roleManager
ûû "
.
ûû" #
RoleExistsAsync
ûû# 2
(
ûû2 3
$str
ûû3 :
)
ûû: ;
)
ûû; <
await
üü 
roleManager
üü !
.
üü! "
CreateAsync
üü" -
(
üü- .
new
üü. 1
IdentityRole
üü2 >
(
üü> ?
$str
üü? F
)
üüF G
)
üüG H
;
üüH I
if
†† 
(
†† 
!
†† 
await
†† 
roleManager
†† "
.
††" #
RoleExistsAsync
††# 2
(
††2 3
$str
††3 8
)
††8 9
)
††9 :
await
°° 
roleManager
°° !
.
°°! "
CreateAsync
°°" -
(
°°- .
new
°°. 1
IdentityRole
°°2 >
(
°°> ?
$str
°°? D
)
°°D E
)
°°E F
;
°°F G
if
¢¢ 
(
¢¢ 
!
¢¢ 
await
¢¢ 
roleManager
¢¢ "
.
¢¢" #
RoleExistsAsync
¢¢# 2
(
¢¢2 3
$str
¢¢3 <
)
¢¢< =
)
¢¢= >
await
££ 
roleManager
££ !
.
££! "
CreateAsync
££" -
(
££- .
new
££. 1
IdentityRole
££2 >
(
££> ?
$str
££? H
)
££H I
)
££I J
;
££J K
}
§§ 	
}
•• 
}¶¶ Œ!
8D:\Fontys\S3\API\API\TestServices\RegisterTestService.cs
	namespace 	
API
 
. 
TestServices 
{		 
public

 

class

 
RegisterTestService

 $
{ 
private 
readonly 
DatabaseContext (
_context) 1
;1 2
public 
RegisterTestService "
(" #
DatabaseContext# 2
context3 :
): ;
{ 	
_context 
= 
context 
; 
} 	
public 
async 
Task 
< 
bool 
> 
PostFanAccount  .
(. /
Fan/ 2
fan3 6
)6 7
{ 	
var 
_fan 
= 
	CreateFan  
(  !
fan! $
)$ %
;% &
try 
{ 
_context 
. 
Fans 
. 
Add !
(! "
_fan" &
)& '
;' (
await 
_context 
. 
SaveChangesAsync /
(/ 0
)0 1
;1 2
return 
true 
; 
} 
catch 
( 
	Exception 
) 
{ 
return 
false 
; 
}   
}!! 	
public## 
async## 
Task## 
<## 
bool## 
>## 
PostCreatorAccount##  2
(##2 3
Creator##3 :
creator##; B
)##B C
{$$ 	
var%% 
_creator%% 
=%% 
CreateCreator%% (
(%%( )
creator%%) 0
)%%0 1
;%%1 2
try&& 
{'' 
_context(( 
.(( 
Creators(( !
.((! "
Add((" %
(((% &
_creator((& .
)((. /
;((/ 0
await)) 
_context)) 
.)) 
SaveChangesAsync)) /
())/ 0
)))0 1
;))1 2
return** 
true** 
;** 
}++ 
catch,, 
(,, 
	Exception,, 
),, 
{-- 
return.. 
false.. 
;.. 
}// 
}00 	
private22 
Fan22 
	CreateFan22 
(22 
Fan22 !
fan22" %
)22% &
{33 	
fan44 
.44 
CreatorFans44 
=44 
new44 !
List44" &
<44& '
CreatorFans44' 2
>442 3
(443 4
)444 5
;445 6
fan55 
.55 

LikedPosts55 
=55 
new55  
List55! %
<55% &

LikedPosts55& 0
>550 1
(551 2
)552 3
;553 4
fan66 
.66 

SavedPosts66 
=66 
new66  
List66! %
<66% &

SavedPosts66& 0
>660 1
(661 2
)662 3
;663 4
fan77 
.77 
	Reactions77 
=77 
new77 
List77  $
<77$ %
Reaction77% -
>77- .
(77. /
)77/ 0
;770 1
return99 
fan99 
;99 
}:: 	
private<< 
Creator<< 
CreateCreator<< %
(<<% &
Creator<<& -
creator<<. 5
)<<5 6
{== 	
creator>> 
.>> 

BannedFans>> 
=>>  
new>>! $
List>>% )
<>>) *
Fan>>* -
>>>- .
(>>. /
)>>/ 0
;>>0 1
creator?? 
.?? 
	Followers?? 
=?? 
new??  #
List??$ (
<??( )
CreatorFans??) 4
>??4 5
(??5 6
)??6 7
;??7 8
creator@@ 
.@@ 
Posts@@ 
=@@ 
new@@ 
List@@  $
<@@$ %
Post@@% )
>@@) *
(@@* +
)@@+ ,
;@@, -
returnBB 
creatorBB 
;BB 
}CC 	
}EE 
}FF 